# 项目开发文档

## 1. 项目简介

Merry Christmas！这是一个圣诞树DIY小程序，可以让用户获得一颗独一无二的圣诞树。通过输入自己的幸运数字，结合随机数，每次生成的圣诞树都是不一样的图案。

## 2. 项目开发流程

开发这个项目时，我想到我应该将之前作业所学的内容都融合起来，比如从一开始的屏幕输出信息，到读取用户输入；从字符串转数字，到调用子程序，以及最后的多文件共同编译。

我首先是构建了项目的雏形，生成一颗圣诞树。通过将端口设为0b800h，我可以在屏幕中指定位置打印指定字符，然后设定好DATASEG，把树的框架画出来（每个字代表一个点，通过数值正负和大小来指引下一个点的移动）。

接着，我创建了菜单子程序，给出提示并读取用户输入；随后我在绘画子程序中将幸运数字字符串转为数字，并加上随机数，从而生成不同的图案。我还创建了另一个tools文件用于存放工具函数，如cls清屏，delay显示延迟等，使用户体验更好。

最后，我在主程序中调用各个子程序和工具函数，完成了这一项目。

## 3. 心得体会

这个项目的起源是我看到答辩日期正好是圣诞节，便想到：“那要不就做一个与之相关的项目吧”。

于是，我决定做一个圣诞树DIY项目，使用者可以输入自己的幸运数字，生成独属于自己的圣诞树。同时，为了加强独特性，我学习了随机数的生成方法，并运用到项目中，使圣诞树的图案更加特殊。

在开发过程中，我融会贯通了之前几次作业学习的知识，并且将许多作业的代码和逻辑复用到这次期末项目中，这种方法极大地提高了我的开发效率和准确度。

## 4.项目成果

![1735054176738](image/项目开发文档/1735054176738.png)

![1735054146103](image/项目开发文档/1735054146103.png)

![1735054192748](image/项目开发文档/1735054192748.png)


### 汇编代码优化建议

#### 1. **减少不必要的段切换**

在代码中，你频繁地切换数据段（DS），这会增加额外的开销。尽量将相关数据放在同一个段中，或在函数开始时切换一次段，并在函数结束时恢复原段。

#### 2. **优化循环结构**

在 `convertNum` 函数中，你使用了一个 `loop` 指令来循环处理输入的字符。然而，`loop` 指令在每次迭代时都会重新加载 `CX` 寄存器的值，这会降低效率。可以考虑使用更高效的循环结构，如使用 `dec cx` 和 `jnz` 指令组合。

#### 3. **减少不必要的内存访问**

在 `convertNum` 函数中，你多次访问 `input_buffer + 1` 和 `input_buffer + 2 + si` 来获取字符数和字符本身。可以将这些值加载到寄存器中，以减少内存访问次数。

#### 4. **优化随机数生成**

你使用端口 `41H` 来生成随机数，但这种方法可能不是最高效的。可以考虑使用其他更高效的随机数生成方法，如线性同余生成器（LCG）。

#### 5. **使用更高效的字符串处理函数**

在 `menu` 函数中，你使用 `int 21H` 函数来处理字符串输入和输出。可以考虑使用更高效的字符串处理函数，如 `lodsb` 和 `stosb`，以减少系统调用的开销。

#### 6. **减少不必要的延时**

在 `menu` 和 `draw` 函数中，你使用了 `delay` 函数来添加延时。然而，过多的延时可能会影响程序的响应性。可以考虑减少或优化延时，以提供更好的用户体验。

#### 7. **代码重构和模块化**

将代码划分为更小的模块或函数，以提高代码的可读性和可维护性。例如，可以将 `menu` 函数拆分为多个子函数，分别处理不同的任务，如打印消息、获取输入和处理输入。

#### 8. **使用更高效的指令**

在 `draw` 函数中，你使用 `mov es:[di],bx` 指令来将数据写入显存。可以考虑使用更高效的指令，如 `stosw`，以减少指令数量和提高执行速度。

#### 9. **优化数据结构**

在 `DATASEG` 段中，你使用了一个较大的数组来存储圣诞树的形状数据。可以考虑使用更紧凑的数据结构，如使用位字段或压缩数据格式，以减少内存占用和提高访问速度。

#### 10. **使用内联汇编**

如果可能的话，可以考虑将一些关键的汇编代码内联到高级语言（如C或C++）中，以利用编译器的优化能力，同时保持对底层硬件的精确控制。
